{"id":"bumicert-platform-19c","title":"My first issue","status":"open","priority":2,"issue_type":"task","owner":"kzoepa@gmail.com","created_at":"2026-02-04T18:34:43.549803937+06:00","created_by":"kzoeps","updated_at":"2026-02-04T18:34:43.549803937+06:00"}
{"id":"bumicert-platform-e5f","title":"Epic: Atproto onboarding invite email + PDS defaults","description":"Add a new onboarding invite-email endpoint using Resend, enforce PDS domain defaults (dev/staging climateai.org, production gainforest.id), and align invite DB checks with pds_domain.","status":"open","priority":1,"issue_type":"epic","assignee":"kzoeps","owner":"kzoepa@gmail.com","created_at":"2026-02-11T22:18:53.519276366+06:00","created_by":"kzoeps","updated_at":"2026-02-11T22:18:53.519276366+06:00"}
{"id":"bumicert-platform-e5f.1","title":"Update PDS domain config defaults","description":"Add allowed PDS domains (climateai.org, gainforest.id) and a defaultPdsDomain (prod -\u003e gainforest.id, else climateai.org). Replace server-side uses of allowedPDSDomains[0] where a single default is intended.","status":"closed","priority":1,"issue_type":"task","assignee":"kzoeps","owner":"kzoepa@gmail.com","created_at":"2026-02-11T22:19:01.051887277+06:00","created_by":"kzoeps","updated_at":"2026-02-11T22:21:25.851192201+06:00","closed_at":"2026-02-11T22:21:25.851192201+06:00","close_reason":"Completed: afe5e17","dependencies":[{"issue_id":"bumicert-platform-e5f.1","depends_on_id":"bumicert-platform-e5f","type":"parent-child","created_at":"2026-02-11T22:19:01.053555847+06:00","created_by":"kzoeps"}]}
{"id":"bumicert-platform-e5f.2","title":"Add Resend mailer + onboarding invite email endpoint","description":"Implement /api/atproto/onboarding/send-invite-email: validate email + pdsDomain, reuse invite if exists, mint via PDS admin if missing, persist invite, and send email with Resend. Add mailer helper and env wiring.","status":"closed","priority":1,"issue_type":"task","assignee":"kzoeps","owner":"kzoepa@gmail.com","created_at":"2026-02-11T22:19:01.065015566+06:00","created_by":"kzoeps","updated_at":"2026-02-11T22:24:37.514232668+06:00","closed_at":"2026-02-11T22:24:37.514232668+06:00","close_reason":"Completed: 3fa7cee","dependencies":[{"issue_id":"bumicert-platform-e5f.2","depends_on_id":"bumicert-platform-e5f","type":"parent-child","created_at":"2026-02-11T22:19:01.066929158+06:00","created_by":"kzoeps"}]}
{"id":"bumicert-platform-e5f.3","title":"Align invite checks with pds_domain","description":"Update invite DB lookups and account creation to include pds_domain where relevant. Update supabase types for invites table.","status":"closed","priority":1,"issue_type":"task","assignee":"kzoeps","owner":"kzoepa@gmail.com","created_at":"2026-02-11T22:19:01.105525487+06:00","created_by":"kzoeps","updated_at":"2026-02-11T22:26:37.163599265+06:00","closed_at":"2026-02-11T22:26:37.163599265+06:00","close_reason":"Completed: e8a7f8e","dependencies":[{"issue_id":"bumicert-platform-e5f.3","depends_on_id":"bumicert-platform-e5f","type":"parent-child","created_at":"2026-02-11T22:19:01.107240486+06:00","created_by":"kzoeps"}]}
{"id":"bumicert-platform-e5f.4","title":"Add changeset for invite email + PDS defaults","description":"Create a single changeset summarizing the new onboarding invite email endpoint and PDS default behavior change.","status":"closed","priority":2,"issue_type":"task","assignee":"kzoeps","owner":"kzoepa@gmail.com","created_at":"2026-02-11T22:19:01.122206761+06:00","created_by":"kzoeps","updated_at":"2026-02-11T22:27:45.488838347+06:00","closed_at":"2026-02-11T22:27:45.488838347+06:00","close_reason":"Completed: be6de27","dependencies":[{"issue_id":"bumicert-platform-e5f.4","depends_on_id":"bumicert-platform-e5f","type":"parent-child","created_at":"2026-02-11T22:19:01.123945567+06:00","created_by":"kzoeps"}]}
{"id":"bumicert-platform-e5f.5","title":"Update client default PDS domain usage","description":"Use defaultPdsDomain instead of allowedPDSDomains[0] in onboarding/signup UI where a single default domain is intended.","status":"open","priority":2,"issue_type":"task","assignee":"kzoeps","owner":"kzoepa@gmail.com","created_at":"2026-02-11T22:28:53.323143954+06:00","created_by":"kzoeps","updated_at":"2026-02-11T22:28:53.323143954+06:00","dependencies":[{"issue_id":"bumicert-platform-e5f.5","depends_on_id":"bumicert-platform-e5f","type":"parent-child","created_at":"2026-02-11T22:28:53.324687539+06:00","created_by":"kzoeps"}]}
{"id":"bumicert-platform-e5f.6","title":"Refactor invites to Supabase + zod","description":"Use Supabase service-role client in invite routes, add zod validation to send-invite-email, and extract shared invite-code minting helper for reuse.","status":"closed","priority":1,"issue_type":"task","assignee":"kzoeps","owner":"kzoepa@gmail.com","created_at":"2026-02-11T22:45:56.247956353+06:00","created_by":"kzoeps","updated_at":"2026-02-11T22:50:20.756778233+06:00","closed_at":"2026-02-11T22:50:20.756778233+06:00","close_reason":"Completed: 46291cb","dependencies":[{"issue_id":"bumicert-platform-e5f.6","depends_on_id":"bumicert-platform-e5f","type":"parent-child","created_at":"2026-02-11T22:45:56.249362966+06:00","created_by":"kzoeps"}]}
{"id":"bumicert-platform-e5f.7","title":"Add per-email rate limiting to send-invite-email endpoint","description":"Prevent email bombing and resource exhaustion on /api/atproto/onboarding/send-invite-email by adding rate limiting using the existing rate_limits table.\n\nImplementation steps:\n1. Add rate limit check in app/api/atproto/onboarding/send-invite-email/route.ts before sending email\n2. Query rate_limits table for most recent entry matching the email and endpoint\n3. Calculate time since last email sent to this address using JavaScript Date objects\n4. Return 429 Too Many Requests with Retry-After header if within rate limit window\n5. After successful email send, delete old rate_limits entries and insert new one (delete-then-insert pattern)\n6. Add env var INVITE_EMAIL_RATE_LIMIT_MINUTES (default: 5 minutes)\n7. Update existing changeset to document this security enhancement\n\nRate limit policy: 1 email per address per 5 minutes (configurable)\n\nDatabase schema (already exists):\n- Table: rate_limits\n  - id: uuid (primary key)\n  - identifier: text (the email address being rate limited)\n  - endpoint: text ('/api/atproto/onboarding/send-invite-email')\n  - created_at: timestamptz (when rate limit entry was created)\n- Note: Table is shared with OTP rate limiting - do NOT add unique constraints\n\nImplementation pattern (delete-then-insert):\n1. Query: SELECT created_at FROM rate_limits WHERE identifier = email AND endpoint = '/api/atproto/onboarding/send-invite-email' ORDER BY created_at DESC LIMIT 1\n2. Check if within rate limit window (\u003c 5 minutes ago)\n3. After successful send: DELETE old entries, then INSERT new entry with current timestamp\n4. Use .single() or check array length to handle no existing records\n\nAcceptance criteria:\n- Requests for same email within 5 minutes return 429 with clear error message\n- Error response includes retry-after timestamp in ISO format and seconds in header\n- Different email addresses are rate-limited independently\n- Rate limit entry only created/updated after successful Resend API call\n- Rate limit window is configurable via environment variable\n- Time comparisons work correctly across time zones using timestamptz\n- No unique constraint added to rate_limits table (preserves OTP compatibility)","status":"open","priority":1,"issue_type":"task","assignee":"kzoeps","owner":"kzoepa@gmail.com","created_at":"2026-02-12T10:47:58.67060318+06:00","created_by":"kzoeps","updated_at":"2026-02-12T11:05:31.559136498+06:00","dependencies":[{"issue_id":"bumicert-platform-e5f.7","depends_on_id":"bumicert-platform-e5f","type":"parent-child","created_at":"2026-02-12T10:47:58.673308364+06:00","created_by":"kzoeps"}]}
